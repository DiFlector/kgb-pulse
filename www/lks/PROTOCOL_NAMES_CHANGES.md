# Изменения в названиях протоколов

## Обзор изменений

Изменена логика создания JSON протоколов для отображения полных названий возрастных групп с диапазоном возрастов.

## Что изменилось

### До изменений:
- Названия протоколов содержали только название группы: "группа 1", "группа 2"
- Не было информации о возрастном диапазоне

### После изменений:
- Названия протоколов содержат полную информацию: "группа 1: 18-29", "группа 2: 30-39"
- Пользователи видят возрастной диапазон для каждой группы

## Измененные файлы

### 1. www/lks/php/secretary/auto_fill_protocols.php
- **Строка 167**: Изменен комментарий для поля `name`
- **Функция `calculateAgeGroupFromClassDistance`**: Возвращает полное название группы с диапазоном возрастов

### 2. www/lks/php/secretary/conduct_draw_json.php
- **Строка 89**: Изменен комментарий для поля `name`
- **Функция `calculateAgeGroupFromClassDistance`**: Возвращает полное название группы с диапазоном возрастов

### 3. www/lks/php/secretary/load_protocols_data.php
- **Строка 184**: Изменено поле `name` для использования полного названия группы
- **Добавлена переменная `$fullGroupName`**: Содержит полное название группы с диапазоном возрастов

### 4. www/lks/php/secretary/SecretaryEventManager.php
- **Строка 176**: Добавлен комментарий о использовании полного названия группы
- **Функция `parseAgeGroups`**: Уже правильно создавала `display_name` с полным названием

## Алгоритм работы

### 1. Получение возрастной группы
Функция `calculateAgeGroupFromClassDistance` работает следующим образом:

1. Находит индекс пола в массиве `sex` из `class_distance`
2. Получает строку возрастных групп для данного пола
3. Разбирает строку по запятым: "группа 1: 18-29, группа 2: 30-39"
4. Для каждой группы проверяет возраст участника
5. Возвращает полное название группы с диапазоном: "группа 1: 18-29"

### 2. Создание протокола
При создании протокола поле `name` заполняется полным названием группы:

```php
$protocolData = [
    'name' => $ageGroup, // Используем полное название группы с диапазоном возрастов
    'protocol_number' => 1,
    'participants' => $participants,
    // ...
];
```

## Примеры названий протоколов

### До изменений:
- "Протокол №1 - группа 1"
- "Протокол №2 - группа 2"

### После изменений:
- "Протокол №1 - группа 1: 18-29"
- "Протокол №2 - группа 2: 30-39"

## Тестирование

Создан тестовый файл `test_simple_protocol_names.php` для проверки правильности работы функции `calculateAgeGroupFromClassDistance`.

### Результаты тестирования:
- ✅ Возраст 25, Пол М → "группа 1: 18-29"
- ✅ Возраст 35, Пол М → "группа 2: 30-39"
- ✅ Возраст 20, Пол Ж → "группа 1: 18-29"
- ✅ Возраст 15, Пол М → null (не подходит по возрасту)

## Совместимость

Изменения обратно совместимы:
- Существующие протоколы продолжат работать
- Новые протоколы будут создаваться с полными названиями
- JSON файлы протоколов будут содержать правильные названия

## Файлы, которые НЕ изменились

Следующие файлы уже правильно использовали полные названия групп:
- `www/lks/test_generate_protocols_simple.php`
- `www/lks/test_protocols_debug.php`
- `www/lks/php/secretary/SecretaryEventManager.php` (функция `parseAgeGroups`)

## Заключение

Все изменения успешно внедрены. Теперь JSON протоколы создаются с полными названиями возрастных групп, содержащими диапазон возрастов. Это улучшает пользовательский опыт и делает протоколы более информативными. 