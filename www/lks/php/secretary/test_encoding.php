<?php
/**
 * Тестовый скрипт для проверки кодировки протоколов
 * Файл: www/lks/php/secretary/test_encoding.php
 */

// Устанавливаем правильную кодировку
if (function_exists('mb_internal_encoding')) {
    mb_internal_encoding('UTF-8');
}

// Тестовые данные с кириллицей
$testData = [
    ['Дорожка', 'Номер спортсмена', 'ФИО', 'Дата рождения', 'Спортивный разряд'],
    ['1', '1754', 'Сайфудинов Павел Сергеевич', '2013', 'Б/р'],
    ['2', '1751', 'Бутяйкин Макар Сергеевич', '2013', 'Б/р'],
    ['3', '1747', 'Балашов Алексей Иванович', '2014', 'Б/р'],
    ['4', '2547', 'Чорбаджи Даниил Сергеевич', '2013', 'Б/р'],
    ['5', '1998', 'Новиков Иван Александрович', '2013', 'Б/р'],
    ['6', '2543', 'Рубис Даниил Денисович', '2014', 'Б/р'],
    ['7', '2540', 'Горлачук Егор Сергеевич', '2013', 'Б/р']
];

// Настройка заголовков HTTP для CSV с правильной кодировкой
header('Content-Type: text/csv; charset=UTF-8');
header('Content-Disposition: attachment; filename="test_encoding.csv"');
header('Cache-Control: max-age=0');

// Добавляем BOM для корректного отображения кириллицы в Excel
echo "\xEF\xBB\xBF";

// Выводим CSV данные с правильной кодировкой для Excel
foreach ($testData as $row) {
    // Создаем строку CSV вручную для лучшего контроля
    $csvLine = '';
    foreach ($row as $index => $value) {
        if ($index > 0) {
            $csvLine .= ';';
        }
        // Экранируем кавычки и заключаем в кавычки
        $value = str_replace('"', '""', $value);
        $csvLine .= '"' . $value . '"';
    }
    echo $csvLine . "\r\n"; // Используем Windows line endings
}
?> 